<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>品信工務系統 - 模型稿 (新配色)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../assets/css/common.css">
    <link rel="stylesheet" href="../assets/css/components.css">
    <link rel="stylesheet" href="../assets/css/pages/dashboard.css">
</head>
<body class="text-main-dark bg-page-light">

    <div class="mobile-container">

        <div id="siteListPage" class="flex flex-col h-screen">
            <header class="bg-accent-blue-primary text-white p-4 flex items-center sticky top-0 z-10">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.37 3.414-1.414 3.414H4.828c-1.784 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z" /></svg>
                <h1 class="text-xl font-bold">我的工地</h1>
            </header>

            <main class="flex-grow p-4 scrollable-content">
                <div class="bg-card-white rounded-lg shadow p-4 mb-4">
                    <h2 class="text-lg font-bold text-main-dark mb-2">工地A：市中心建案</h2>
                    <p class="text-sm text-gray-dark mb-1 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 text-gray-medium" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" /></svg>
                        今日主要工項: 模板組立
                    </p>
                    <p class="text-sm text-gray-dark mb-2 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 text-gray-medium" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                        剩餘工期: 120 天
                    </p>
                    <div class="flex items-center mb-3">
                        <span class="h-3 w-3 bg-green-500 rounded-full mr-2"></span>
                        <p class="text-xs font-medium text-main-dark status-success">進度正常</p>
                    </div>
                    <a href="#siteDashboardPage" class="block text-right text-sm font-medium accent-blue-primary">
                        查看儀表板 &gt;
                    </a>
                </div>

                <div class="bg-card-white rounded-lg shadow p-4 mb-4">
                    <h2 class="text-lg font-bold text-main-dark mb-2">工地B：山區別墅區</h2>
                    <p class="text-sm text-gray-dark mb-1 flex items-center">
                         <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 text-gray-medium" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" /></svg>
                        今日主要工項: 鋼筋綁紮
                    </p>
                    <p class="text-sm text-gray-dark mb-2 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 text-gray-medium" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                        剩餘工期: 95 天
                    </p>
                    <div class="flex items-center mb-3">
                        <span class="h-3 w-3 bg-yellow-400 rounded-full mr-2"></span>
                        <p class="text-xs font-medium text-main-dark status-warning">輕微延遲</p>
                    </div>
                    <a href="#siteDashboardPage" class="block text-right text-sm font-medium accent-blue-primary">
                        查看儀表板 &gt;
                    </a>
                </div>
            </main>
        </div>

        <div id="siteDashboardPage" class="flex flex-col h-screen hidden">
            <header class="bg-page-light text-main-dark p-4 flex items-center sticky top-0 z-10 border-b border-gray-light-accent">
                <a href="#siteListPage" class="accent-blue-primary mr-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
                    </svg>
                </a>
                <h1 class="text-xl font-bold text-main-dark">工地A儀表板</h1>
            </header>

            <main class="flex-grow p-4 scrollable-content space-y-4">
                <div class="bg-card-white rounded-lg shadow p-4 text-center">
                    <div class="progress-ring mx-auto mb-2" style="--progress: 85;">
                        <svg class="w-full h-full" viewBox="0 0 36 36">
                            <path class="progress-ring-track"
                                d="M18 2.0845
                                  a 15.9155 15.9155 0 0 1 0 31.831
                                  a 15.9155 15.9155 0 0 1 0 -31.831"
                                fill="none" stroke-width="3.8" />
                            <path class="progress-ring-bar"
                                d="M18 2.0845
                                  a 15.9155 15.9155 0 0 1 0 31.831
                                  a 15.9155 15.9155 0 0 1 0 -31.831"
                                fill="none" stroke-width="3.8" stroke-dasharray="85, 100" />
                        </svg>
                        <span class="progress-ring-text text-2xl">85%</span>
                    </div>
                    <p class="text-sm font-medium text-main-dark">累積已請款進度</p>
                </div>

                <div class="bg-card-white rounded-lg shadow p-4">
                    <div class="flex justify-between items-center mb-2">
                        <h3 class="text-base font-bold text-main-dark">目標工項</h3>
                        <div class="text-xs">
                            <span class="bg-accent-blue-primary text-white py-1 px-2 rounded-l-md cursor-pointer text-xs">下一期</span>
                            <span class="bg-gray-light-accent text-gray-dark py-1 px-2 rounded-r-md cursor-pointer text-xs">所有未請款</span>
                        </div>
                    </div>
                    <ul class="text-sm text-gray-dark space-y-1">
                        <li>- 水電配管工程 - $XXX,XXX</li>
                        <li>- 弱電系統佈線 - $YYY,YYY</li>
                        <li>- 消防設備安裝 - $ZZZ,ZZZ</li>
                    </ul>
                </div>

                <div class="bg-card-white rounded-lg shadow p-4">
                    <h3 class="text-base font-bold text-main-dark mb-2">重要提醒</h3>
                    <ul class="text-sm text-gray-dark space-y-1">
                        <li class="flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 text-gray-medium" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
                            合約完工日: 2025-12-31
                        </li>
                        <li class="flex items-center">
                             <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 accent-blue-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                            <span class="accent-blue-primary font-medium">剩餘工期: 120 天</span>
                        </li>
                        <li class="flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 accent-blue-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                            <span class="accent-blue-primary font-medium">工地保險到期: 2025-10-01</span>
                        </li>
                        <li class="flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 status-error" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>
                            <span class="status-error font-medium">(管理部提醒: 下週颱風預警)</span>
                        </li>
                    </ul>
                </div>

                <div class="bg-card-white rounded-lg shadow p-4">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-base font-bold text-main-dark">進度時間軸</h3>
                        <div class="text-xs">
                            <button id="ganttPrevPeriodBtnDashboard" class="text-gray-medium p-1">&lt;</button>
                            <button id="ganttScaleMonthBtnDashboard" class="bg-accent-blue-primary text-white py-1 px-2 rounded text-xs">月</button>
                            <button id="ganttScaleWeekBtnDashboard" class="text-gray-medium py-1 px-2 text-xs">週</button>
                            <button id="ganttScaleDayBtnDashboard" class="text-gray-medium py-1 px-2 text-xs">日</button>
                            <button id="ganttNextPeriodBtnDashboard" class="text-gray-medium p-1">&gt;</button>
                        </div>
                    </div>
                    <div class="gantt-chart-container">
                        <div id="ganttTimelineHeaderDashboard" class="gantt-timeline-header">
                            <!-- 日期標頭將由 gantt.js 動態生成 -->
                        </div>
                        <div id="ganttTasksAreaDashboard" class="gantt-tasks-area" style="position: relative;">
                            <!-- 今日線和任務條將由 gantt.js 動態生成 -->
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script type="module" src="../assets/js/pages/dashboard.js"></script>
    <script src="../assets/js/utils/navigation.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 非導航相關邏輯保留
            function setRingProgress(ringElement, percentage) {
                const circle = ringElement.querySelector('.progress-ring-bar');
                const textElement = ringElement.querySelector('.progress-ring-text');
                if (circle) {
                    circle.style.strokeDasharray = `${percentage}, 100`;
                }
                if (textElement) {
                    textElement.textContent = `${percentage}%`;
                }
            }
            const exampleRing = document.querySelector('.progress-ring');
            if(exampleRing) {
                const progress = parseInt(exampleRing.style.getPropertyValue('--progress') || '85', 10); // 預設85%
                setRingProgress(exampleRing, progress);
            }

            // 初始化導航
            const navConfigs = [
                {
                    triggerSelector: 'a[href="#siteDashboardPage"]',
                    targetPageId: 'siteDashboardPage',
                    options: {
                        pageSelector: '.mobile-container > div', // More specific selector for pages in this file
                        activeClass: 'flex', // This page uses flex for active
                        hiddenClass: 'hidden',
                        animationType: 'simple', // Using simple class toggle
                        titleUpdates: [{
                            elementId: 'siteDashboardPageHeaderTitle', // Assuming the h1 in dashboard header needs an ID
                            content: (triggerEl) => {
                                const siteCard = triggerEl.closest('.bg-card-white');
                                if (siteCard) {
                                    const siteNameH2 = siteCard.querySelector('h2');
                                    if (siteNameH2) {
                                        return `${siteNameH2.textContent.split('：')[0]}儀表板`;
                                    }
                                }
                                return '工地儀表板'; // Default
                            }
                        }],
                        beforeNavigate: (targetPageId, triggerElement, context) => {
                            // Update context if needed, e.g., selected site name
                            const siteCard = triggerElement.closest('.bg-card-white');
                            if (siteCard) {
                                const siteNameH2 = siteCard.querySelector('h2');
                                if (siteNameH2) {
                                     context.selectedSiteName = siteNameH2.textContent.split('：')[0];
                                }
                            }
                        },
                        afterNavigate: (targetPageId, triggerElement, context) => {
                            if (targetPageId === 'siteDashboardPage' && context.selectedSiteName) {
                                const titleElement = document.querySelector('#siteDashboardPage header h1');
                                if (titleElement) {
                                    titleElement.textContent = `${context.selectedSiteName}儀表板`;
                                }
                            }
                        },
                        recordScrollOnLeaveFrom: ['siteListPage'] // 當離開 siteListPage 前往 siteDashboardPage 時記錄滾動
                    }
                },
                {
                    triggerSelector: 'a[href="#siteListPage"]',
                    targetPageId: 'siteListPage',
                    options: {
                        pageSelector: '.mobile-container > div',
                        activeClass: 'flex',
                        hiddenClass: 'hidden',
                        animationType: 'simple',
                        preserveScrollOnReturnTo: ['siteListPage'] // 當回到 siteListPage 時恢復滾動
                    }
                }
            ];
            
            // Determine initial page based on which one doesn't have 'hidden'
            let initialPage = 'siteListPage'; // Default
            if (document.getElementById('siteDashboardPage') && !document.getElementById('siteDashboardPage').classList.contains('hidden')) {
                initialPage = 'siteDashboardPage';
            }
             // Add IDs to page divs if they don't have them, or ensure they are correct.
            // For this file, siteListPage and siteDashboardPage are the main ones.
            // Ensure the header title in siteDashboardPage has an ID if it's to be updated by titleUpdates.
            const dashboardHeaderTitle = document.querySelector('#siteDashboardPage header h1');
            if (dashboardHeaderTitle && !dashboardHeaderTitle.id) {
                dashboardHeaderTitle.id = 'siteDashboardPageHeaderTitle';
            }


            setInitialPage(initialPage); // Set initial page for navigation.js
            initializeNavigation(navConfigs);
        });
    </script>
</body>
</html>
